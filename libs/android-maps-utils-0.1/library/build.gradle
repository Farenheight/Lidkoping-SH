buildscript {
    repositories {
        mavenCentral()
    }

    dependencies {
        classpath 'com.android.tools.build:gradle:0.5.+'
    }
}

apply plugin: 'android-library'
apply plugin: 'maven'
apply plugin: 'signing'

archivesBaseName = 'android-maps-utils'
group = 'com.google.maps.android'

dependencies {
    compile 'com.google.android.gms:play-services:3.1.36+'
}

android {
    compileSdkVersion 17
    buildToolsVersion "17.0.0"

    sourceSets {
        main {
            manifest.srcFile 'AndroidManifest.xml'
            java.srcDirs = ['src']
            res.srcDirs = ['res']
        }
    }
}

task apklib(type: Zip) {
    dependsOn 'packageReleaseJar'
    into("android-maps-utils-${version}") {
        from 'AndroidManifest.xml'
        into('res') {
            from 'res'
        }
        into('libs') {
            from 'build/bundles/release/classes.jar'
            rename 'classes.jar', "android-maps-utils-${version}.jar"
        }
    }
}

signing {
    sign configurations.archives
}

if(!hasProperty("sonatypeUsername")){
    sonatypeUsername = ""
}
if(!hasProperty("sonatypePassword")){
    sonatypePassword = ""
}

uploadArchives {
    repositories {
        mavenDeployer {
            beforeDeployment { MavenDeployment deployment -> signing.signPom(deployment) }

            repository(url: 'https://oss.sonatype.org/service/local/staging/deploy/maven2') {
                authentication(userName: sonatypeUsername, password: sonatypePassword)
            }
            snapshotRepository(url: 'https://oss.sonatype.org/content/repositories/snapshots/') {
                authentication(userName: sonatypeUsername, password: sonatypePassword)
            }

            pom.project {
                url 'https://github.com/googlemaps/android-maps-utils'

                scm {
                    url 'scm:git@github.com:googlemaps/android-maps-utils.git'
                    connection 'scm:git@github.com:googlemaps/android-maps-utils.git'
                    developerConnection 'scm:git@github.com:googlemaps/android-maps-utils.git'
                }

                licenses {
                    license {
                        name 'The Apache Software License, Version 2.0'
                        url 'http://www.apache.org/licenses/LICENSE-2.0.txt'
                        distribution 'repo'
                    }
                }
            }
        }
    }
}
